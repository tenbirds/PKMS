<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Owms">

	<typeAlias alias="OwmsModel" type="com.pkms.common.owms.model.OwmsModel"/>
	
	<select id="OwmsDao.read" parameterClass="OwmsModel" resultClass="OwmsModel">
	SELECT 
	    SEQ, SEQ_NO,
	    PROC_ST_CD,
	    NVL(PE_STATUS, '1') AS PE_STATUS,
	    NVL(PE_STATUS_NAME, '과금접수') AS PE_STATUS_NAME,
	    CTT_0, AUDIT_EMP_NUM_0, CHG_DTM_0,
	    CTT_10, AUDIT_EMP_NUM_10, CHG_DTM_10,
	    CTT_20, AUDIT_EMP_NUM_20, CHG_DTM_20,
	    CTT_25, AUDIT_EMP_NUM_25, CHG_DTM_25,
	    CTT_30, AUDIT_EMP_NUM_30, CHG_DTM_30,
	    CTT_35, AUDIT_EMP_NUM_35, CHG_DTM_35,
	    CTT_40, AUDIT_EMP_NUM_40, CHG_DTM_40,
	    CTT_50, AUDIT_EMP_NUM_50, CHG_DTM_50,
	    CTT_60, AUDIT_EMP_NUM_60, CHG_DTM_60,
	    CTT_65, AUDIT_EMP_NUM_65, CHG_DTM_65,
	    CTT_90, AUDIT_EMP_NUM_90, CHG_DTM_90
	FROM
	(
		SELECT
		    OPL.SEQ, OPL.SEQ_NO,
		    L.PROC_ST_CD,
		    CASE
		        WHEN L.PROC_ST_CD = 0  THEN '1'
		        WHEN L.PROC_ST_CD = 10 THEN '2'
		        WHEN L.PROC_ST_CD = 20 THEN '2'
		        WHEN L.PROC_ST_CD = 25 THEN '9'
		        WHEN L.PROC_ST_CD = 30 THEN '3'
		        WHEN L.PROC_ST_CD = 35 THEN '9'
		        WHEN L.PROC_ST_CD = 40 THEN '3'
		        WHEN L.PROC_ST_CD = 50 THEN '3'
		        WHEN L.PROC_ST_CD = 60 THEN '3'
		        WHEN L.PROC_ST_CD = 65 THEN '3'
		        WHEN L.PROC_ST_CD = 90 THEN '3'
		      END AS PE_STATUS
		   , CASE
		        WHEN L.PROC_ST_CD = 0  THEN '과금접수'
		        WHEN L.PROC_ST_CD = 10 THEN '과금처리중'
		        WHEN L.PROC_ST_CD = 20 THEN '과금처리중'
		        WHEN L.PROC_ST_CD = 25 THEN '과금처리반려'
		        WHEN L.PROC_ST_CD = 30 THEN '과금처리완료'
		        WHEN L.PROC_ST_CD = 35 THEN '과금처리반려'
		        WHEN L.PROC_ST_CD = 40 THEN '과금처리완료'
		        WHEN L.PROC_ST_CD = 50 THEN '과금처리완료'
		        WHEN L.PROC_ST_CD = 60 THEN '과금처리완료'
		        WHEN L.PROC_ST_CD = 65 THEN '과금처리완료'
		        WHEN L.PROC_ST_CD = 90 THEN '과금처리완료'
		      END AS PE_STATUS_NAME,
		    A.CTT_0, A.AUDIT_EMP_NUM_0, A.CHG_DTM_0,
		    B.CTT_10, B.AUDIT_EMP_NUM_10, B.CHG_DTM_10,
		    C.CTT_20, C.AUDIT_EMP_NUM_20, C.CHG_DTM_20,
		    D.CTT_25, D.AUDIT_EMP_NUM_25, D.CHG_DTM_25,
		    E.CTT_30, E.AUDIT_EMP_NUM_30, E.CHG_DTM_30,
		    F.CTT_35, F.AUDIT_EMP_NUM_35 , F.CHG_DTM_35,
		    G.CTT_40, G.AUDIT_EMP_NUM_40 , G.CHG_DTM_40,
		    H.CTT_50, H.AUDIT_EMP_NUM_50 , H.CHG_DTM_50,
		    I.CTT_60, I.AUDIT_EMP_NUM_60 , I.CHG_DTM_60,
		    J.CTT_65, J.AUDIT_EMP_NUM_65, J.CHG_DTM_65,
		    K.CTT_90, K.AUDIT_EMP_NUM_90 , K.CHG_DTM_90
		FROM PKMS.OWM_PKMS_LINK OPL,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_0, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_0,  CHG_DTM AS CHG_DTM_0  FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '0' ) A,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_10, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_10, CHG_DTM AS CHG_DTM_10 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '10' ) B,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_20, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_20, CHG_DTM AS CHG_DTM_20 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '20' ) C,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_25, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_25, CHG_DTM AS CHG_DTM_25 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '25' ) D,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_30, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_30, CHG_DTM AS CHG_DTM_30 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '30' ) E,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_35, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_35, CHG_DTM AS CHG_DTM_35 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '35' ) F,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_40, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_40, CHG_DTM AS CHG_DTM_40 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '40' ) G,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_50, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_50, CHG_DTM AS CHG_DTM_50 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '50' ) H,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_60, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_60, CHG_DTM AS CHG_DTM_60 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '60' ) I,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_65, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_65, CHG_DTM AS CHG_DTM_65 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '65' ) J,
		(SELECT SEQ_NO, PROC_ST_CD, CTT AS CTT_90, AUDIT_EMP_NUM AS AUDIT_EMP_NUM_90, CHG_DTM AS CHG_DTM_90 FROM PKMS.OWM_PKMS_LINK WHERE PROC_ST_CD = '90' ) K,
		(SELECT SEQ_NO, MAX(PROC_ST_CD) AS PROC_ST_CD FROM PKMS.OWM_PKMS_LINK GROUP BY SEQ_NO ) L
		WHERE OPL.SEQ_NO = A.SEQ_NO(+)
		AND OPL.SEQ_NO = B.SEQ_NO(+)
		AND OPL.SEQ_NO = C.SEQ_NO(+)
		AND OPL.SEQ_NO = D.SEQ_NO(+)
		AND OPL.SEQ_NO = E.SEQ_NO(+)
		AND OPL.SEQ_NO = F.SEQ_NO(+)
		AND OPL.SEQ_NO = G.SEQ_NO(+)
		AND OPL.SEQ_NO = H.SEQ_NO(+)
		AND OPL.SEQ_NO = I.SEQ_NO(+)
		AND OPL.SEQ_NO = J.SEQ_NO(+)
		AND OPL.SEQ_NO = K.SEQ_NO(+)
		AND OPL.SEQ_NO = L.SEQ_NO(+)
		AND OPL.SEQ_NO = #seq_no#
		AND ROWNUM = 1
	)
	RIGHT OUTER JOIN dual ON SEQ = NVL(SEQ, '')
	</select>

</sqlMap>